/*!
 Leaflet.MarkerCluster.LayerSupport 1.0.2+7558cd3
 (c) 2015-2016 Boris Seang
 License MIT
 */
!function(e,r){"function"==typeof define&&define.amd?define(["leaflet"],r):r("object"==typeof module&&module.exports?require("leaflet"):e.L)}(this,function(e,r){!function(e,r){"function"==typeof define&&define.amd?define(["leaflet"],function(e){return e.MarkerClusterGroup.LayerSupport=r(e)}):"object"==typeof module&&module.exports?module.exports=r(require("leaflet")):e.L.MarkerClusterGroup.LayerSupport=r(e.L)}(this,function(e,r){var t=e.MarkerClusterGroup,i=t.prototype,o=t.extend({statics:{version:"1.0.1"},options:{singleAddRemoveBufferDuration:100},initialize:function(e){i.initialize.call(this,e),this._featureGroup=new a,this._featureGroup.addEventParent(this),this._nonPointGroup=new a,this._nonPointGroup.addEventParent(this),this._layers={},this._proxyLayerGroups={},this._proxyLayerGroupsNeedRemoving={},this._singleAddRemoveBuffer=[]},checkIn:function(e){var r=this._toArray(e);return this._checkInGetSeparated(r),this},checkOut:function(r){var t,i,o=this._toArray(r),a=this._separateSingleFromGroupLayers(o,{groups:[],singles:[]}),s=a.groups,n=a.singles;for(t=0;t<n.length;t++)i=n[t],delete this._layers[e.stamp(i)],delete i._mcgLayerSupportGroup;for(this._originalRemoveLayers(n),t=0;t<s.length;t++)i=s[t],this._dismissProxyLayerGroup(i);return this},addLayers:function(r){var t,i,o,a=this._toArray(r),s=this._checkInGetSeparated(a),n=s.groups;for(this._originalAddLayers(s.singles),t=0;t<n.length;t++)i=n[t],o=e.stamp(i),this._proxyLayerGroups[o]=i,delete this._proxyLayerGroupsNeedRemoving[o],this._map&&this._map._originalAddLayer(i)},addLayer:function(e){return this._bufferSingleAddRemove(e,"addLayers"),this},_originalAddLayer:i.addLayer,_originalAddLayers:i.addLayers,removeLayers:function(r){var t,i,o=this._toArray(r),a=this._separateSingleFromGroupLayers(o,{groups:[],singles:[]}),s=a.groups,n=a.singles,u=0;for(this._originalRemoveLayers(n);u<s.length;u++)t=s[u],i=e.stamp(t),delete this._proxyLayerGroups[i],this._map?this._map._originalRemoveLayer(t):this._proxyLayerGroupsNeedRemoving[i]=t;return this},removeLayer:function(e){return this._bufferSingleAddRemove(e,"removeLayers"),this},_originalRemoveLayer:i.removeLayer,_originalRemoveLayers:i.removeLayers,onAdd:function(r){r._originalAddLayer=r._originalAddLayer||r.addLayer,r._originalRemoveLayer=r._originalRemoveLayer||r.removeLayer,e.extend(r,n);var t,o,a,s=this._removePreAddedLayers(r);i.onAdd.call(this,r);for(t in this._proxyLayerGroups)o=this._proxyLayerGroups[t],r._originalAddLayer(o);for(t in this._proxyLayerGroupsNeedRemoving)o=this._proxyLayerGroupsNeedRemoving[t],r._originalRemoveLayer(o),delete this._proxyLayerGroupsNeedRemoving[t];for(a=0;a<s.length;a++)r.addLayer(s[a])},_bufferSingleAddRemove:function(r,t){var i,o=this.options.singleAddRemoveBufferDuration;o>0?(this._singleAddRemoveBuffer.push({type:t,layer:r}),this._singleAddRemoveBufferTimeout||(i=e.bind(this._processSingleAddRemoveBuffer,this),this._singleAddRemoveBufferTimeout=setTimeout(i,o))):this[t](r)},_processSingleAddRemoveBuffer:function(){for(var e,r,t=this._singleAddRemoveBuffer,i=0,o=[];i<t.length;i++)e=t[i],r||(r=e.type),e.type===r?o.push(e.layer):(this[r](o),o=[e.layer]);this[r](o),t.length=0,clearTimeout(this._singleAddRemoveBufferTimeout),this._singleAddRemoveBufferTimeout=null},_checkInGetSeparated:function(r){var t,i,o=this._separateSingleFromGroupLayers(r,{groups:[],singles:[]}),a=o.groups,s=o.singles;for(t=0;t<a.length;t++)i=a[t],this._recruitLayerGroupAsProxy(i);for(t=0;t<s.length;t++)i=s[t],this._removeFromOtherGroupsOrMap(i),this._layers[e.stamp(i)]=i,i._mcgLayerSupportGroup=this;return o},_separateSingleFromGroupLayers:function(r,t){for(var i,o=t.groups,a=t.singles,s=e.Util.isArray,n=0;n<r.length;n++)i=r[n],i instanceof e.LayerGroup?(o.push(i),this._separateSingleFromGroupLayers(i.getLayers(),t)):s(i)?this._separateSingleFromGroupLayers(i,t):a.push(i);return t},_recruitLayerGroupAsProxy:function(r){var t=r._proxyMcgLayerSupportGroup;if(t){if(t===this)return;t.checkOut(r)}else this._removeFromOwnMap(r);r._proxyMcgLayerSupportGroup=this,r._originalAddLayer=r._originalAddLayer||r.addLayer,r._originalRemoveLayer=r._originalRemoveLayer||r.removeLayer,e.extend(r,s)},_dismissProxyLayerGroup:function(t){if(t._proxyMcgLayerSupportGroup!==r&&t._proxyMcgLayerSupportGroup===this){delete t._proxyMcgLayerSupportGroup,t.addLayer=t._originalAddLayer,t.removeLayer=t._originalRemoveLayer;var i=e.stamp(t);delete this._proxyLayerGroups[i],delete this._proxyLayerGroupsNeedRemoving[i],this._removeFromOwnMap(t)}},_removeFromOtherGroupsOrMap:function(e){var r=e._mcgLayerSupportGroup;if(r){if(r===this)return;r.checkOut(e)}else e.__parent?e.__parent._group.removeLayer(e):this._removeFromOwnMap(e)},_removeFromOwnMap:function(e){e._map&&e._map.removeLayer(e)},_removePreAddedLayers:function(e){var r,t=this._layers,i=[];for(var o in t)r=t[o],r._map&&(i.push(r),e._originalRemoveLayer(r));return i},_toArray:function(r){return e.Util.isArray(r)?r:[r]}}),a=e.FeatureGroup.extend({addLayer:function(r){if(this.hasLayer(r))return this;r.addEventParent(this);var t=e.stamp(r);return this._layers[t]=r,this._map&&this._map._originalAddLayer(r),this.fire("layeradd",{layer:r})},removeLayer:function(r){if(!this.hasLayer(r))return this;r in this._layers&&(r=this._layers[r]),r.removeEventParent(this);var t=e.stamp(r);return this._map&&this._layers[t]&&this._map._originalRemoveLayer(this._layers[t]),delete this._layers[t],this.fire("layerremove",{layer:r})},onAdd:function(e){this._map=e,this.eachLayer(e._originalAddLayer,e)},onRemove:function(e){this.eachLayer(e._originalRemoveLayer,e),this._map=null}}),s={addLayer:function(e){var r=this.getLayerId(e);return this._layers[r]=e,this._map?this._proxyMcgLayerSupportGroup.addLayer(e):this._proxyMcgLayerSupportGroup.checkIn(e),this},removeLayer:function(e){var r=e in this._layers?e:this.getLayerId(e);return this._proxyMcgLayerSupportGroup.removeLayer(e),delete this._layers[r],this}},n={addLayer:function(e){return e._mcgLayerSupportGroup?e._mcgLayerSupportGroup._originalAddLayer(e):this._originalAddLayer(e)},removeLayer:function(e){return e._mcgLayerSupportGroup?e._mcgLayerSupportGroup._originalRemoveLayer(e):this._originalRemoveLayer(e)}};return e.markerClusterGroup.layerSupport=function(e){return new o(e)},o})});