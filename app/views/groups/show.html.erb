<div class="group">

  <h1>
  <%= @group.name %> / <%= pluralize @group.memberships.count, "member" %>
  <%= link_to '(Edit)', edit_group_path(@group) if @group.is_admin?(current_user) %>
  </h1>

  <div class="row">
    <div class="col-md-6">
    <p><%= @group.description%></p>
    </div>

    <div class="col-md-6">
    <%= image_tag @group.image_url unless @group.image_url.blank? %>
    </div>
  </div>
  
  <nav>
    <ul class="nav navbar-nav" style=""> 
      <li><%= link_to 'Map', '#map' %></li>
      <li><%= link_to 'Hour', '#hour' %></li>
      <li><%= link_to 'Week', '#week' %></li>
      <li><%= link_to 'Month', '#month' %></li>
    </ul>
  </nav>

  <h2 class="clear">Hour</h2>
  <canvas id="hour" width="300" height="100"></canvas>

  <h2>Week</h2>
  <canvas id="week" width="300" height="100"></canvas>

  <h2 class="clear">Month</h2>
  <div id="month" class="" style="height:400px; width:90%; background-color:gray;">
  </div>

  <h2>Map</h2>
  <div class="clear" id='map'></div>

</div>

<%= content_for :script do %>
  //HOUR LINE

  function generateData(points, baseline){
    var d = [];
    for (i=0; i<points; i++){
      d.push({ x: i, y: (Math.floor(Math.random() * 201) - 100)  });
    }
    return d;
  };

  var hour_datasets = [
    { label: 'Ups', fill: false, backgroundColor: "orange", borderColor: "silver", data: generateData(24) }
  ];

  <% if user_signed_in? %>
    hour_datasets.push({ label: 'My Ups', fill: false, backgroundColor: "orange", 
      borderColor: "silver", data: generateData(24,0), 
      borderDash: [10.0, 10.0], borderDashOffset: 1.0
    });
  <% end %>

  var hourCanvas = document.getElementById("hour");
  var hourChart = new Chart(hourCanvas, {
    type: 'line',
    data: { datasets: hour_datasets },
    options: {
      scales: { 
        xAxes: [{ type: 'linear', position: 'bottom' }],
        yAxes: [{ ticks: { max: 100, min: -100 } }]
      }
    }
  });


  console.log(hourChart.chart.controller);
  //hourChart.chart.controller.boxes[2] //xaxis
  //hourChart.chart.controller.boxes[3] //xaxis
  //hourChart.render(1000, false)

  // WEEK LINE
  var week_datasets = [
    { label: 'Ups', fill: false, backgroundColor: "orange", 
      borderColor: "silver", data: generateData(7) }
  ];

  <% if user_signed_in? %>
    week_datasets.push({ label: 'My Ups', fill: false, backgroundColor: "orange", 
      borderColor: "silver", data: generateData(7,0), 
      borderDash: [10.0, 10.0], borderDashOffset: 1.0
    });
  <% end %>
  
  var weekCanvas = document.getElementById("week");
  var weekChart = new Chart(weekCanvas, {
    type: 'line',
    data: { datasets: week_datasets },
    options: {
      scales: {
        xAxes: [{ type: 'linear', position: 'bottom' }],
        yAxes: [{ ticks: { max: 100, min: -100 } }]
      }
    }
  });


  //MAP
  var map = L.map('map');
  map.setView([54.04354, -2.78502], 15);

  L.tileLayer('http://a.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
    maxZoom: 18, subdomains: '', }).addTo(map);

  var normalIcon = L.icon({
    iconUrl: '<%= asset_path('marker-icon.png') %>',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -27],
    shadowUrl: '<%= asset_path('marker-shadow.png') %>',
    shadowSize: [41, 41],
    shadowAnchor: [13, 41]
  });

  var markers = L.markerClusterGroup({ spiderfyOnMaxZoom: false, disableClusteringAtZoom: 16 });  
  var str = '';
  var marker;
  var opts = { color: "orange", fillColor: 'white', fillOpacity: 1, weight: 4 };

  <% for marker in @markers %>   
    if (<%= marker[:state] %>){ opts.color = "orange"; } else { opts.color = "blue"; }
    if (<%= marker[:is_mine] %>){ opts.fillColor = "white"; } else { opts.fillColor = opts.color; }
    marker = L.circle(<%= marker[:latlng] %>, 5, opts);
    marker.bindPopup('<%= marker[:popup] %>'); 
    markers.addLayer(marker);
  <% end %>
  
  map.addLayer(markers);

<% end %>